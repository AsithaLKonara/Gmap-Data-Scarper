import{r as a,j as e,o as s,I as T,t as n}from"./index-cuttc60L.js";import{C as M}from"./copy-DbiKsodF.js";const C=[{value:"lead_capture",label:"Lead Capture Form"},{value:"testimonial",label:"Testimonial Widget"},{value:"metrics",label:"Metrics Badge"}],z=()=>{const[y,j]=a.useState([]),[d,i]=a.useState(!1),[S,r]=a.useState(!1),[v,k]=a.useState("lead_capture"),[m,w]=a.useState(""),[o,c]=a.useState({open:!1,widget:null}),[p,N]=a.useState(""),[x,g]=a.useState({open:!1,widget:null}),[h,b]=a.useState({open:!1,widget:null});a.useEffect(()=>{u()},[]);const u=async()=>{i(!0);try{const t=await fetch("/api/widgets",{credentials:"include"});if(!t.ok)throw new Error(await t.text());j(await t.json())}catch{j([])}finally{i(!1)}},E=async t=>{t.preventDefault(),i(!0);try{const l=m?JSON.parse(m):void 0,f=await fetch("/api/widgets",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({type:v,config:l})});if(!f.ok)throw new Error(await f.text());n({title:"Widget created",status:"success"}),r(!1),w(""),u()}catch(l){n({title:"Error",description:l.message,status:"error"})}finally{i(!1)}},W=t=>{N(t.config?JSON.stringify(t.config,null,2):""),c({open:!0,widget:t})},O=async()=>{if(o.widget){i(!0);try{const t=p?JSON.parse(p):void 0,l=await fetch(`/api/widgets/${o.widget.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({config:t})});if(!l.ok)throw new Error(await l.text());n({title:"Widget updated",status:"success"}),c({open:!1,widget:null}),u()}catch(t){n({title:"Error",description:t.message,status:"error"})}finally{i(!1)}}},D=async()=>{if(x.widget){i(!0);try{const t=await fetch(`/api/widgets/${x.widget.id}`,{method:"DELETE",credentials:"include"});if(!t.ok)throw new Error(await t.text());n({title:"Widget deleted",status:"success"}),g({open:!1,widget:null}),u()}catch(t){n({title:"Error",description:t.message,status:"error"})}finally{i(!1)}}};return e.jsxs("div",{className:"max-w-3xl mx-auto py-8 px-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-blue-600 mb-4",children:"Widget Management"}),e.jsx("div",{className:"flex justify-end mb-4",children:e.jsx(s,{onClick:()=>r(!0),children:"Create Widget"})}),y.length===0?e.jsx("div",{className:"text-gray-500",children:"No widgets yet."}):e.jsx("div",{className:"space-y-4",children:y.map(t=>{var l;return e.jsxs("div",{className:"bg-white rounded-lg shadow p-4 flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("span",{className:"font-semibold text-blue-600",children:((l=C.find(f=>f.value===t.type))==null?void 0:l.label)||t.type}),e.jsx("span",{className:`text-xs px-2 py-1 rounded ${t.is_active?"bg-green-100 text-green-700":"bg-gray-200 text-gray-600"}`,children:t.is_active?"Active":"Inactive"}),e.jsxs("span",{className:"text-xs text-gray-400",children:["Created: ",new Date(t.created_at).toLocaleString()]}),e.jsx(s,{size:"sm",variant:"outline",onClick:()=>b({open:!0,widget:t}),children:"Preview"}),e.jsx(s,{size:"sm",variant:"outline",onClick:()=>W(t),children:"Edit"}),e.jsx(s,{size:"sm",variant:"danger",onClick:()=>g({open:!0,widget:t}),children:"Delete"})]}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Widget ID: ",t.id]}),t.embed_code&&e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx(T,{value:t.embed_code,readOnly:!0,className:"font-mono"}),e.jsx("button",{onClick:()=>{navigator.clipboard.writeText(t.embed_code||""),n({title:"Copied",status:"success"})},className:"p-2 rounded hover:bg-gray-100","aria-label":"Copy embed code",children:e.jsx(M,{size:16})})]}),t.config&&e.jsx("pre",{className:"bg-gray-50 rounded p-2 text-xs mt-2",children:JSON.stringify(t.config,null,2)})]},t.id)})}),S&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-40",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg max-w-md w-full p-6 relative",children:[e.jsx("button",{className:"absolute top-2 right-2 text-gray-400 hover:text-gray-600 text-2xl font-bold",onClick:()=>r(!1),"aria-label":"Close",children:"×"}),e.jsx("h2",{className:"text-xl font-bold mb-4 text-blue-600",children:"Create Widget"}),e.jsxs("form",{onSubmit:E,className:"flex flex-col gap-3",children:[e.jsx("label",{className:"font-semibold",children:"Type"}),e.jsx("select",{value:v,onChange:t=>k(t.target.value),className:"border border-gray-300 rounded px-2 py-1",children:C.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))}),e.jsx("label",{className:"font-semibold",children:"Config (JSON)"}),e.jsx("textarea",{value:m,onChange:t=>w(t.target.value),placeholder:'{"title":"Contact Us","fields":["name","email"]}',className:"border border-gray-300 rounded px-2 py-1 min-h-[80px] font-mono"}),e.jsxs("div",{className:"flex justify-end gap-2 mt-6",children:[e.jsx(s,{type:"button",onClick:()=>r(!1),variant:"outline",children:"Cancel"}),e.jsx(s,{type:"submit",disabled:d,children:d?"Creating...":"Create"})]})]})]})}),o.open&&o.widget&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-40",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg max-w-md w-full p-6 relative",children:[e.jsx("button",{className:"absolute top-2 right-2 text-gray-400 hover:text-gray-600 text-2xl font-bold",onClick:()=>c({open:!1,widget:null}),"aria-label":"Close",children:"×"}),e.jsx("h2",{className:"text-xl font-bold mb-4 text-blue-600",children:"Edit Widget"}),e.jsxs("form",{onSubmit:t=>{t.preventDefault(),O()},className:"flex flex-col gap-3",children:[e.jsx("label",{className:"font-semibold",children:"Config (JSON)"}),e.jsx("textarea",{value:p,onChange:t=>N(t.target.value),className:"border border-gray-300 rounded px-2 py-1 min-h-[80px] font-mono"}),e.jsxs("div",{className:"flex justify-end gap-2 mt-6",children:[e.jsx(s,{type:"button",onClick:()=>c({open:!1,widget:null}),variant:"outline",children:"Cancel"}),e.jsx(s,{type:"submit",disabled:d,children:d?"Saving...":"Save"})]})]})]})}),x.open&&x.widget&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-40",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg max-w-md w-full p-6 relative",children:[e.jsx("button",{className:"absolute top-2 right-2 text-gray-400 hover:text-gray-600 text-2xl font-bold",onClick:()=>g({open:!1,widget:null}),"aria-label":"Close",children:"×"}),e.jsx("h2",{className:"text-xl font-bold mb-4 text-red-600",children:"Delete Widget"}),e.jsx("p",{children:"Are you sure you want to delete this widget?"}),e.jsxs("div",{className:"flex justify-end gap-2 mt-6",children:[e.jsx(s,{type:"button",onClick:()=>g({open:!1,widget:null}),variant:"outline",children:"Cancel"}),e.jsx(s,{type:"button",onClick:D,variant:"danger",disabled:d,children:d?"Deleting...":"Delete"})]})]})}),h.open&&h.widget&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-40",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg max-w-md w-full p-6 relative",children:[e.jsx("button",{className:"absolute top-2 right-2 text-gray-400 hover:text-gray-600 text-2xl font-bold",onClick:()=>b({open:!1,widget:null}),"aria-label":"Close",children:"×"}),e.jsx("h2",{className:"text-xl font-bold mb-4 text-blue-600",children:"Widget Preview"}),e.jsx("pre",{className:"bg-gray-50 rounded p-2 text-xs mt-2",children:JSON.stringify(h.widget.config,null,2)}),e.jsx("div",{className:"flex justify-end gap-2 mt-6",children:e.jsx(s,{type:"button",onClick:()=>b({open:!1,widget:null}),variant:"outline",children:"Close"})})]})})]})};export{z as default};
//# sourceMappingURL=Widgets-yLt6HldA.js.map
