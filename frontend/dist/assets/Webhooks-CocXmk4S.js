import{r as o,j as e,o as i,t as a,D as A,I as y}from"./index-cuttc60L.js";import{C as D}from"./copy-DbiKsodF.js";const m=[{value:"job.completed",label:"Job Completed"},{value:"lead.created",label:"Lead Created"}],B=()=>{const[k,N]=o.useState([]),[h,r]=o.useState(!1),[S,c]=o.useState(!1),[n,C]=o.useState(null),[d,x]=o.useState({url:"",event:m[0].value,secret:""}),[w,b]=o.useState(!1),[E,L]=o.useState(null),[g,p]=o.useState([]),[j,f]=o.useState(null),u=async()=>{r(!0);try{const s=await(await fetch("/api/webhooks/",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}})).json();N(s)}catch{a({title:"Error",description:"Failed to load webhooks",status:"error"})}finally{r(!1)}};o.useEffect(()=>{u()},[]);const v=t=>{C(t||null),x(t?{url:t.url,event:t.event,secret:t.secret||""}:{url:"",event:m[0].value,secret:""}),c(!0)},T=async()=>{if(!d.url)return a({title:"URL required",status:"error"});r(!0);try{const t=n?"PUT":"POST",s=n?`/api/webhooks/${n.id}`:"/api/webhooks/",l=await fetch(s,{method:t,headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({...d})});if(!l.ok)throw new Error(await l.text());c(!1),u(),a({title:n?"Webhook updated":"Webhook created",status:"success"})}catch(t){a({title:"Error",description:t.message,status:"error"})}finally{r(!1)}},W=async t=>{if(window.confirm("Delete this webhook?")){r(!0);try{const s=await fetch(`/api/webhooks/${t}`,{method:"DELETE",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!s.ok)throw new Error(await s.text());u(),a({title:"Webhook deleted",status:"success"})}catch(s){a({title:"Error",description:s.message,status:"error"})}finally{r(!1)}}},_=async t=>{r(!0);try{const s=await fetch(`/api/webhooks/${t.id}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({is_active:!t.is_active})});if(!s.ok)throw new Error(await s.text());u(),a({title:`Webhook ${t.is_active?"disabled":"enabled"}`,status:"success"})}catch(s){a({title:"Error",description:s.message,status:"error"})}finally{r(!1)}},z=async t=>{f(t.id);try{const s=await fetch("/api/webhooks/test",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({webhook_id:t.id})}),l=await s.json();if(!s.ok)throw new Error(l.detail||l.message||"Test failed");a({title:"Test sent",description:l.message||"Webhook test sent",status:"success"})}catch(s){a({title:"Error",description:s.message,status:"error"})}finally{f(null)}},O=async t=>{b(!0),L(t),p([]);try{const l=await(await fetch(`/api/webhooks/${t.id}/delivery-log`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}})).json();p(l)}catch{p([])}};return e.jsxs("div",{className:"max-w-3xl mx-auto py-8 px-4",children:[e.jsx("h1",{className:"text-2xl font-bold mb-6",children:"Webhooks"}),e.jsx("div",{className:"mb-4 flex justify-end",children:e.jsx(i,{onClick:()=>v(),children:"Add Webhook"})}),e.jsx("div",{className:"bg-white rounded shadow p-4",children:h?e.jsx("div",{children:"Loading..."}):e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left py-2",children:"Event"}),e.jsx("th",{className:"text-left py-2",children:"URL"}),e.jsx("th",{className:"text-left py-2",children:"Status"}),e.jsx("th",{className:"text-left py-2",children:"Last Delivery"}),e.jsx("th",{className:"text-left py-2",children:"Secret"}),e.jsx("th",{})]})}),e.jsx("tbody",{children:k.map(t=>{var s;return e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"py-2",children:((s=m.find(l=>l.value===t.event))==null?void 0:s.label)||t.event}),e.jsx("td",{className:"py-2",children:t.url}),e.jsxs("td",{className:"py-2 flex items-center gap-2",children:[e.jsx("span",{children:t.is_active?"Active":"Inactive"}),e.jsx(i,{size:"sm",variant:"outline",onClick:()=>_(t),disabled:h,children:t.is_active?"Disable":"Enable"})]}),e.jsxs("td",{className:"py-2",children:[t.last_delivery_status||"-"," ",t.last_delivery_at?e.jsxs("span",{className:"text-xs text-gray-500",children:["(",new Date(t.last_delivery_at).toLocaleString(),")"]}):null,e.jsx(i,{size:"sm",variant:"outline",className:"ml-2",onClick:()=>O(t),children:"View Log"})]}),e.jsx("td",{className:"py-2 flex items-center gap-2",children:t.secret?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"font-mono text-xs",children:t.secret}),e.jsx("button",{onClick:()=>{navigator.clipboard.writeText(t.secret||""),a({title:"Copied",status:"success"})},children:e.jsx(D,{size:14})})]}):e.jsx("span",{className:"text-xs text-gray-400",children:"None"})}),e.jsxs("td",{className:"py-2 flex gap-2",children:[e.jsx(i,{size:"sm",variant:"outline",onClick:()=>v(t),children:"Edit"}),e.jsx(i,{size:"sm",variant:"destructive",onClick:()=>W(t.id),children:"Delete"}),e.jsx(i,{size:"sm",variant:"outline",onClick:()=>z(t),disabled:j===t.id,children:j===t.id?"Testing...":"Test"})]})]},t.id)})})]})}),e.jsxs("div",{className:"mt-4 text-xs text-gray-500",children:[e.jsx("strong",{children:"Signature:"})," If you set a secret, each webhook request will include an ",e.jsx("code",{children:"X-Webhook-Signature"})," header (HMAC SHA256 of the body)."]}),e.jsx(A,{open:S,onOpenChange:c,children:e.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-50 bg-black bg-opacity-40",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg max-w-md w-full p-6 relative",children:[e.jsx("button",{className:"absolute top-2 right-2 text-gray-400 hover:text-gray-600 text-2xl font-bold",onClick:()=>c(!1),"aria-label":"Close",children:"×"}),e.jsx("h2",{className:"text-xl font-bold mb-4",children:n?"Edit Webhook":"Add Webhook"}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx("label",{className:"text-sm font-medium",children:"Event"}),e.jsx("select",{className:"border rounded px-2 py-1",value:d.event,onChange:t=>x(s=>({...s,event:t.target.value})),children:m.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))}),e.jsx("label",{className:"text-sm font-medium",children:"Webhook URL"}),e.jsx(y,{value:d.url,onChange:t=>x(s=>({...s,url:t.target.value})),placeholder:"https://yourapp.com/webhook"}),e.jsx("label",{className:"text-sm font-medium",children:"Secret (optional)"}),e.jsx(y,{value:d.secret,onChange:t=>x(s=>({...s,secret:t.target.value})),placeholder:"Secret for signing (optional)"})]}),e.jsxs("div",{className:"flex justify-end gap-2 mt-6",children:[e.jsx(i,{variant:"outline",onClick:()=>c(!1),disabled:h,children:"Cancel"}),e.jsx(i,{onClick:T,disabled:h,children:n?"Update":"Create"})]})]})})}),w&&E&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-50 bg-black bg-opacity-40",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg max-w-md w-full p-6 relative",children:[e.jsx("button",{className:"absolute top-2 right-2 text-gray-400 hover:text-gray-600 text-2xl font-bold",onClick:()=>b(!1),"aria-label":"Close",children:"×"}),e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Delivery Log"}),g.length===0?e.jsx("div",{className:"text-gray-500",children:"No delivery log found."}):e.jsx("ul",{className:"text-xs",children:g.map((t,s)=>e.jsxs("li",{className:"mb-2",children:[e.jsxs("div",{children:["Status: ",e.jsx("span",{className:"font-mono",children:t.status})]}),e.jsxs("div",{children:["Time: ",new Date(t.timestamp).toLocaleString()]}),t.response_code&&e.jsxs("div",{children:["Response Code: ",t.response_code]}),t.error&&e.jsxs("div",{className:"text-red-500",children:["Error: ",t.error]})]},s))})]})})]})};export{B as default};
//# sourceMappingURL=Webhooks-CocXmk4S.js.map
