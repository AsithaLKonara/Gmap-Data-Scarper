import{j as e,u as M,r as l,q as P,s as D,v as T,o as p,I as G,w as J,x as b}from"./index-cuttc60L.js";import{T as K,a as X,b as _,c as d,d as ee,e as u}from"./table-BqXMkODy.js";import{c as N,u as ae}from"./create-icon-Dj5rIplF.js";import"./icon-BANxJJXO.js";import"./use-style-config-BvA8OEwb.js";const se=N({d:"M0,12a1.5,1.5,0,0,0,1.5,1.5h8.75a.25.25,0,0,1,.25.25V22.5a1.5,1.5,0,0,0,3,0V13.75a.25.25,0,0,1,.25-.25H22.5a1.5,1.5,0,0,0,0-3H13.75a.25.25,0,0,1-.25-.25V1.5a1.5,1.5,0,0,0-3,0v8.75a.25.25,0,0,1-.25.25H1.5A1.5,1.5,0,0,0,0,12Z",displayName:"AddIcon"}),te=N({displayName:"ViewIcon",path:e.jsxs("g",{fill:"currentColor",children:[e.jsx("path",{d:"M23.432,10.524C20.787,7.614,16.4,4.538,12,4.6,7.6,4.537,3.213,7.615.568,10.524a2.211,2.211,0,0,0,0,2.948C3.182,16.351,7.507,19.4,11.839,19.4h.308c4.347,0,8.671-3.049,11.288-5.929A2.21,2.21,0,0,0,23.432,10.524ZM7.4,12A4.6,4.6,0,1,1,12,16.6,4.6,4.6,0,0,1,7.4,12Z"}),e.jsx("circle",{cx:"12",cy:"12",r:"2"})]})}),ne=N({displayName:"DeleteIcon",path:e.jsx("g",{fill:"currentColor",children:e.jsx("path",{d:"M19.452 7.5H4.547a.5.5 0 00-.5.545l1.287 14.136A2 2 0 007.326 24h9.347a2 2 0 001.992-1.819L19.95 8.045a.5.5 0 00-.129-.382.5.5 0 00-.369-.163zm-9.2 13a.75.75 0 01-1.5 0v-9a.75.75 0 011.5 0zm5 0a.75.75 0 01-1.5 0v-9a.75.75 0 011.5 0zM22 4h-4.75a.25.25 0 01-.25-.25V2.5A2.5 2.5 0 0014.5 0h-5A2.5 2.5 0 007 2.5v1.25a.25.25 0 01-.25.25H2a1 1 0 000 2h20a1 1 0 000-2zM9 3.75V2.5a.5.5 0 01.5-.5h5a.5.5 0 01.5.5v1.25a.25.25 0 01-.25.25h-5.5A.25.25 0 019 3.75z"})})}),re=N({displayName:"EditIcon",path:e.jsxs("g",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeWidth:"2",children:[e.jsx("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),e.jsx("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})]})}),le=b`
  query Leads {
    leads {
      id
      name
      email
      phone
      company
      tag
      notes
      status
      source
      created_at
      updated_at
    }
  }
`,oe=b`
  query Analytics {
    analytics {
      totalLeads
      leadsByStatus
      conversionRate
    }
  }
`,ce=b`
  mutation CreateLead($name: String!, $email: String!, $phone: String, $company: String, $tag: String, $notes: String, $status: String, $source: String) {
    createLead(name: $name, email: $email, phone: $phone, company: $company, tag: $tag, notes: $notes, status: $status, source: $source) {
      lead { id name email status }
    }
  }
`,ie=b`
  mutation UpdateLead($leadId: Int!, $name: String, $email: String, $phone: String, $company: String, $tag: String, $notes: String, $status: String, $source: String) {
    updateLead(leadId: $leadId, name: $name, email: $email, phone: $phone, company: $company, tag: $tag, notes: $notes, status: $status, source: $source) {
      lead { id name email status }
    }
  }
`,de=b`
  mutation DeleteLead($leadId: Int!) {
    deleteLead(leadId: $leadId) { ok }
  }
`,fe=()=>{const{t:a}=M(),[m,w]=l.useState([]),[t,n]=l.useState(null),[c,A]=l.useState(!1),[r,me]=l.useState(!1),[L,S]=l.useState(null),[C,q]=l.useState(""),[k,B]=l.useState(""),[g,z]=l.useState(""),x=P(),{isOpen:H,onOpen:j,onClose:y}=ae(),{data:f,loading:xe,refetch:$}=D(le),{data:i,loading:he,refetch:E}=D(oe),[R]=T(ce),[V]=T(ie),[F]=T(de);l.useEffect(()=>{f&&f.leads&&w(f.leads)},[f]),l.useEffect(()=>{var s,o,h,v;i&&i.analytics&&n({total_leads:i.analytics.totalLeads,new_leads:((s=i.analytics.leadsByStatus)==null?void 0:s.new)||0,contacted_leads:((o=i.analytics.leadsByStatus)==null?void 0:o.contacted)||0,qualified_leads:((h=i.analytics.leadsByStatus)==null?void 0:h.qualified)||0,converted_leads:((v=i.analytics.leadsByStatus)==null?void 0:v.converted)||0,conversion_rate:i.analytics.conversionRate*100})},[i]);const Q=async s=>{try{await R({variables:s}),x({title:a("Success"),description:a("Lead added successfully"),status:"success",duration:3e3}),$(),E(),y()}catch(o){x({title:a("Error"),description:o.message,status:"error",duration:3e3})}},U=async(s,o)=>{try{await V({variables:{leadId:s,...o}}),x({title:a("Success"),description:a("Lead updated successfully"),status:"success",duration:3e3}),$(),E(),y()}catch(h){x({title:a("Error"),description:h.message,status:"error",duration:3e3})}},W=async s=>{if(confirm(a("Are you sure you want to delete this lead?")))try{await F({variables:{leadId:s}}),x({title:a("Success"),description:a("Lead deleted successfully"),status:"success",duration:3e3}),$(),E()}catch(o){x({title:a("Error"),description:o.message,status:"error",duration:3e3})}},Y=s=>{switch(s){case"new":return"blue";case"contacted":return"yellow";case"qualified":return"orange";case"converted":return"green";default:return"gray"}},I=m.filter(s=>{const o=!C||s.status===C,h=!k||s.tag===k,v=!g||s.name.toLowerCase().includes(g.toLowerCase())||s.email.toLowerCase().includes(g.toLowerCase())||s.company&&s.company.toLowerCase().includes(g.toLowerCase());return o&&h&&v}),Z=[...new Set(m.map(s=>s.tag).filter(Boolean))],O=s=>s==="converted"?"converted":s==="contacted"||s==="qualified"?"in_progress":"to_contact";return m.map(s=>({id:s.id.toString(),name:s.name,email:s.email,company:s.company,stage:O(s.status)})),e.jsxs("div",{className:"min-h-screen bg-gray-100 dark:bg-gray-800","data-tour":"crm-main",children:[e.jsxs("div",{className:"max-w-7xl mx-auto py-8 px-4","data-tour":"crm-content",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6 gradient-text","data-tour":"crm-title",children:a("CRM Leads")}),e.jsxs("div",{className:"flex justify-between items-center mb-4","data-tour":"crm-actions",children:[e.jsx(p,{colorScheme:"blue",onClick:j,"data-tour":"crm-add-lead",children:a("Add Lead")}),e.jsx(p,{colorScheme:"green",onClick:handleExportLeads,"data-tour":"crm-export",children:a("Export Leads")})]}),t&&e.jsxs("div",{className:"grid gap-6 grid-cols-1 sm:grid-cols-2 md:grid-cols-4",children:[e.jsx("div",{children:e.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-lg p-4 shadow",children:[e.jsx("span",{className:"text-sm text-gray-500",children:a("Total Leads")}),e.jsx("span",{className:"text-2xl font-bold",children:t.total_leads}),e.jsx("span",{className:"inline-block text-green-500 mr-1",children:"↑"}),e.jsx("span",{className:"text-xs text-gray-400",children:"23.36%"})]})}),e.jsx("div",{children:e.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-lg p-4 shadow",children:[e.jsx("span",{className:"text-sm text-gray-500",children:a("New Leads")}),e.jsx("span",{className:"text-2xl font-bold",children:t.new_leads}),e.jsx("span",{className:"text-xs text-gray-400",children:a("This month")})]})}),e.jsx("div",{children:e.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-lg p-4 shadow",children:[e.jsx("span",{className:"text-sm text-gray-500",children:a("Conversion Rate")}),e.jsxs("span",{className:"text-2xl font-bold",children:[t.conversion_rate.toFixed(1),"%"]}),e.jsx("span",{className:"inline-block text-green-500 mr-1",children:"↑"}),e.jsx("span",{className:"text-xs text-gray-400",children:"12.5%"})]})}),e.jsx("div",{children:e.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-lg p-4 shadow",children:[e.jsx("span",{className:"text-sm text-gray-500",children:a("Converted")}),e.jsx("span",{className:"text-2xl font-bold",children:t.converted_leads}),e.jsx("span",{className:"text-xs text-gray-400",children:a("This month")})]})})]}),e.jsx("div",{className:"bg-white dark:bg-gray-900 rounded-lg p-4 shadow","data-tour":"crm-filters",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-center gap-4 mb-4",children:[e.jsx(G,{placeholder:a("Search leads..."),value:g,onChange:s=>z(s.target.value),maxW:"300px"}),e.jsxs(Select,{placeholder:a("Filter by status"),value:C,onChange:s=>q(s.target.value),maxW:"200px",children:[e.jsx("option",{value:"new",children:a("New")}),e.jsx("option",{value:"contacted",children:a("Contacted")}),e.jsx("option",{value:"qualified",children:a("Qualified")}),e.jsx("option",{value:"converted",children:a("Converted")})]}),e.jsx(Select,{placeholder:a("Filter by tag"),value:k,onChange:s=>B(s.target.value),maxW:"200px",children:Z.map(s=>e.jsx("option",{value:s,children:s},s))}),e.jsx(p,{leftIcon:e.jsx(se,{}),colorScheme:"blue",onClick:()=>{S(null),j()},children:a("Add Lead")})]})}),e.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-lg p-4 shadow","data-tour":"crm-leads-table",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:a("Leads")}),c?e.jsx(Flex,{justify:"center",py:8,children:e.jsx("div",{className:"w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"})}):I.length===0?e.jsxs("div",{className:"flex items-center p-4 mb-4 text-blue-800 rounded-lg bg-blue-50 dark:bg-gray-800 dark:text-blue-400",children:[e.jsx("svg",{className:"w-5 h-5 mr-2",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{d:"M18 10A8 8 0 11..."})}),a("No leads found. Add your first lead to get started!")]}):e.jsxs(K,{variant:"simple",children:[e.jsx(X,{children:e.jsxs(_,{children:[e.jsx(d,{children:a("Name")}),e.jsx(d,{children:a("Email")}),e.jsx(d,{children:a("Company")}),e.jsx(d,{children:a("Status")}),e.jsx(d,{children:a("Tag")}),e.jsx(d,{children:a("Created")}),e.jsx(d,{children:a("Actions")})]})}),e.jsx(ee,{children:I.map(s=>e.jsxs(_,{children:[e.jsx(u,{fontWeight:"bold",children:s.name}),e.jsx(u,{children:s.email}),e.jsx(u,{children:s.company||"-"}),e.jsx(u,{children:e.jsx(J,{colorScheme:Y(s.status),children:a(s.status)})}),e.jsx(u,{children:s.tag||"-"}),e.jsx(u,{children:new Date(s.created_at).toLocaleDateString()}),e.jsx(u,{children:e.jsxs(HStack,{spacing:2,children:[e.jsx(Tooltip,{label:a("View Details"),children:e.jsx(IconButton,{"aria-label":a("View lead"),icon:e.jsx(te,{}),size:"sm",variant:"ghost",onClick:()=>{S(s),j()}})}),e.jsx(Tooltip,{label:a("Edit Lead"),children:e.jsxs("div",{className:"relative group",children:[e.jsx("button",{className:"p-2 rounded hover:bg-gray-200 dark:hover:bg-gray-700","aria-label":a("Edit Lead"),onClick:()=>{S(s),j()},children:e.jsx(re,{})}),e.jsx("span",{className:"absolute left-1/2 -translate-x-1/2 bottom-full mb-2 hidden group-hover:block bg-gray-800 text-white text-xs rounded py-1 px-2 z-10",children:a("Edit Lead")})]})}),e.jsx(Tooltip,{label:a("Delete Lead"),children:e.jsxs("div",{className:"relative group",children:[e.jsx("button",{className:"p-2 rounded hover:bg-gray-200 dark:hover:bg-gray-700","aria-label":a("Delete Lead"),onClick:()=>W(s.id),children:e.jsx(ne,{})}),e.jsx("span",{className:"absolute left-1/2 -translate-x-1/2 bottom-full mb-2 hidden group-hover:block bg-gray-800 text-white text-xs rounded py-1 px-2 z-10",children:a("Delete Lead")})]})})]})})]},s.id))})]})]})]}),H&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-40",children:e.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-lg shadow-lg w-full max-w-lg p-6 relative",children:[e.jsx("button",{className:"absolute top-2 right-2 text-gray-400 hover:text-gray-600",onClick:y,"aria-label":"Close",children:"×"}),e.jsx("h2",{className:"text-xl font-semibold mb-4",children:a(L?"Edit Lead":"Add New Lead")}),e.jsx(ue,{lead:L,onSubmit:L?U:Q,onCancel:y})]})})]})},ue=({lead:a,onSubmit:m,onCancel:w})=>{const{t}=M(),[n,c]=l.useState({name:(a==null?void 0:a.name)||"",email:(a==null?void 0:a.email)||"",phone:(a==null?void 0:a.phone)||"",company:(a==null?void 0:a.company)||"",tag:(a==null?void 0:a.tag)||"",notes:(a==null?void 0:a.notes)||"",status:(a==null?void 0:a.status)||"new"}),A=r=>{r.preventDefault(),a?m(a.id,n):m(n)};return e.jsx("form",{onSubmit:A,children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:t("Name")}),e.jsx("input",{type:"text",value:n.name,onChange:r=>c({...n,name:r.target.value}),className:"w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:t("Email")}),e.jsx("input",{type:"email",value:n.email,onChange:r=>c({...n,email:r.target.value}),className:"w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:t("Phone")}),e.jsx("input",{type:"tel",value:n.phone,onChange:r=>c({...n,phone:r.target.value}),className:"w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:t("Company")}),e.jsx("input",{type:"text",value:n.company,onChange:r=>c({...n,company:r.target.value}),className:"w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:t("Tag")}),e.jsx("input",{type:"text",value:n.tag,onChange:r=>c({...n,tag:r.target.value}),className:"w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:t("Status")}),e.jsxs("select",{value:n.status,onChange:r=>c({...n,status:r.target.value}),className:"w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"new",children:t("New")}),e.jsx("option",{value:"contacted",children:t("Contacted")}),e.jsx("option",{value:"qualified",children:t("Qualified")}),e.jsx("option",{value:"converted",children:t("Converted")})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:t("Notes")}),e.jsx("textarea",{value:n.notes,onChange:r=>c({...n,notes:r.target.value}),className:"w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",rows:3})]}),e.jsxs(HStack,{spacing:4,w:"full",children:[e.jsx(p,{type:"submit",colorScheme:"blue",flex:1,children:t(a?"Update Lead":"Add Lead")}),e.jsx(p,{onClick:w,variant:"outline",flex:1,children:t("Cancel")})]})]})})};export{fe as default};
//# sourceMappingURL=CRM-D-0EQJom.js.map
