import{r as l,u as Y,a7 as Z,a8 as $,a9 as ee,j as e,B as m,H as g,a4 as T,e as d,m as se,V as ae,d as U,I as A,l as w,T as B,o as D,p,q as c,s as R,t as o,v as I,M as te,y as re,z as ne,D as le,J as ie,K as ce,aa as oe,ab as de,ac as me,ad as he,ae as ue,af as xe,ag as je}from"./index-Cdt--gnJ.js";const ye=()=>{const[M,L]=l.useState([]),[i,C]=l.useState(null),[f,N]=l.useState([]),[v,_]=l.useState(""),[y,E]=l.useState(""),[k,z]=l.useState("member"),[H,u]=l.useState(!1),[b,P]=l.useState(""),n=Y(),[x,a]=l.useState(!1),[F,t]=l.useState(null),[O,ge]=l.useState([]),[pe,fe]=l.useState(null),[S,V]=l.useState(null);l.useEffect(()=>{Z().then(V),h()},[]);const h=async()=>{a(!0),t(null);try{const s=await $();L(s),s.length>0&&(C(s[0]),j(s[0].id))}catch(s){t(s.message||"Failed to load teams"),n({title:"Error",description:s.message,status:"error"})}finally{a(!1)}},j=async s=>{a(!0),t(null);try{const r=await ee(s);N(r)}catch(r){t(r.message||"Failed to load members"),n({title:"Error",description:r.message,status:"error"})}finally{a(!1)}},q=async()=>{if(v.trim()){a(!0),t(null);try{await de({name:v}),_(""),h(),n({title:"Team created",status:"success"})}catch(s){t(s.message||"Failed to create team"),n({title:"Error",description:s.message,status:"error"})}finally{a(!1)}}},J=async()=>{if(y.trim()){a(!0),t(null);try{await xe(i.id,{email:y,role:k}),E(""),z("member"),j(i.id),n({title:"User invited",status:"success"})}catch(s){t(s.message||"Failed to invite user"),n({title:"Error",description:s.message,status:"error"})}finally{a(!1)}}},K=async s=>{a(!0),t(null);try{await ue(i.id,s),j(i.id),n({title:"Member removed",status:"info"})}catch(r){t(r.message||"Failed to remove member"),n({title:"Error",description:r.message,status:"error"})}finally{a(!1)}},G=async()=>{if(b){a(!0),t(null);try{await je(i.id,Number(b)),u(!1),h(),n({title:"Ownership transferred",status:"success"})}catch(s){t(s.message||"Failed to transfer ownership"),n({title:"Error",description:s.message,status:"error"})}finally{a(!1)}}},Q=async s=>{a(!0),t(null);try{await me(s),h(),n({title:"Invite accepted",status:"success"})}catch(r){t(r.message||"Failed to accept invite"),n({title:"Error",description:r.message,status:"error"})}finally{a(!1)}},W=async s=>{a(!0),t(null);try{await he(s),h(),n({title:"Invite declined",status:"info"})}catch(r){t(r.message||"Failed to decline invite"),n({title:"Error",description:r.message,status:"error"})}finally{a(!1)}};return S&&S.plan!=="pro"&&S.plan!=="business"?e.jsxs(m,{p:8,children:[e.jsx(g,{size:"lg",mb:6,children:"Team Management"}),e.jsx(T,{color:"red.500",mb:4,children:"Team features are only available on Pro and Business plans."}),e.jsx(d,{colorScheme:"blue",href:"/upgrade",children:"Upgrade Plan"})]}):e.jsxs(m,{p:8,"data-tour":"team-main",children:[e.jsx(g,{size:"lg",mb:6,"data-tour":"team-title",children:"Team Management"}),x&&e.jsx(se,{"data-tour":"team-loading"}),F&&e.jsx(T,{color:"red.500","data-tour":"team-error",children:F}),e.jsxs(ae,{align:"stretch",spacing:6,"data-tour":"team-content",children:[e.jsx(m,{"data-tour":"team-create",children:e.jsxs(U,{children:[e.jsx(A,{placeholder:"New team name",value:v,onChange:s=>_(s.target.value),"data-tour":"team-name-input"}),e.jsx(d,{colorScheme:"blue",onClick:q,isLoading:x,"data-tour":"team-create-btn",children:"Create Team"})]})}),e.jsx(m,{"data-tour":"team-select",children:e.jsx(w,{value:(i==null?void 0:i.id)||"",onChange:s=>{const r=M.find(X=>X.id===Number(s.target.value));C(r),j(r.id)},placeholder:"Select a team","data-tour":"team-select-dropdown",children:M.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))})}),O.length>0&&e.jsxs(m,{children:[e.jsx(g,{size:"sm",mb:2,children:"Pending Invites"}),e.jsxs(B,{size:"sm",children:[e.jsx(D,{children:e.jsxs(p,{children:[e.jsx(c,{children:"Team"}),e.jsx(c,{children:"Role"}),e.jsx(c,{children:"Status"}),e.jsx(c,{children:"Invited At"}),e.jsx(c,{children:"Actions"})]})}),e.jsx(R,{children:O.map(s=>e.jsxs(p,{children:[e.jsx(o,{children:s.team_name}),e.jsx(o,{children:e.jsx(I,{children:s.role})}),e.jsx(o,{children:s.status}),e.jsx(o,{children:new Date(s.invited_at).toLocaleString()}),e.jsx(o,{children:s.status==="invited"&&e.jsxs(e.Fragment,{children:[e.jsx(d,{size:"xs",colorScheme:"green",onClick:()=>Q(s.id),children:"Accept"}),e.jsx(d,{size:"xs",colorScheme:"red",onClick:()=>W(s.id),children:"Decline"})]})})]},s.id))})]})]}),i&&e.jsxs(m,{children:[e.jsx(g,{size:"md",mb:4,children:"Members"}),f.length===0?e.jsx(T,{color:"gray.500",children:"No members yet."}):e.jsxs(B,{size:"sm",children:[e.jsx(D,{children:e.jsxs(p,{children:[e.jsx(c,{children:"User ID"}),e.jsx(c,{children:"Email"}),e.jsx(c,{children:"Role"}),e.jsx(c,{children:"Status"}),e.jsx(c,{children:"Invited At"}),e.jsx(c,{children:"Actions"})]})}),e.jsx(R,{children:f.map(s=>e.jsxs(p,{bg:s.user_id===i.owner_id?"yellow.50":void 0,children:[e.jsxs(o,{children:[s.user_id,s.user_id===i.owner_id&&e.jsx(I,{ml:2,colorScheme:"yellow",children:"Owner"})]}),e.jsx(o,{children:s.email||"-"}),e.jsx(o,{children:e.jsx(I,{colorScheme:s.role==="admin"?"blue":s.role==="member"?"green":"gray",children:s.role})}),e.jsx(o,{children:s.status}),e.jsx(o,{children:new Date(s.invited_at).toLocaleString()}),e.jsx(o,{children:e.jsx(d,{size:"xs",colorScheme:"red",onClick:()=>K(s.user_id),isDisabled:s.user_id===i.owner_id,children:"Remove"})})]},s.id))})]}),e.jsxs(U,{mt:4,children:[e.jsx(A,{placeholder:"Invite email",value:y,onChange:s=>E(s.target.value)}),e.jsxs(w,{value:k,onChange:s=>z(s.target.value),w:"120px",children:[e.jsx("option",{value:"member",children:"Member"}),e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"viewer",children:"Viewer"})]}),e.jsx(d,{colorScheme:"blue",onClick:J,isLoading:x,children:"Invite"})]}),e.jsx(d,{mt:4,colorScheme:"yellow",onClick:()=>u(!0),children:"Transfer Ownership"}),e.jsxs(te,{isOpen:H,onClose:()=>u(!1),children:[e.jsx(re,{}),e.jsxs(ne,{children:[e.jsx(le,{children:"Transfer Ownership"}),e.jsx(ie,{}),e.jsx(ce,{children:e.jsx(w,{placeholder:"Select new owner",value:b,onChange:s=>P(s.target.value),children:f.filter(s=>s.user_id!==i.owner_id).map(s=>e.jsx("option",{value:s.user_id,children:s.user_id},s.user_id))})}),e.jsxs(oe,{children:[e.jsx(d,{variant:"ghost",mr:3,onClick:()=>u(!1),children:"Cancel"}),e.jsx(d,{colorScheme:"yellow",onClick:G,isLoading:x,children:"Transfer"})]})]})]})]})]})]})};export{ye as default};
//# sourceMappingURL=TeamManagement-CNxJykpS.js.map
