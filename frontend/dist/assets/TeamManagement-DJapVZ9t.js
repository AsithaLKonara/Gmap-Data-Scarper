import{j as e,u as se,r as m}from"./index-cuttc60L.js";import{getUser as ne,getTeams as re,listTeamMembers as ie,createTeam as le,acceptTeamInvite as oe,declineTeamInvite as ce,removeTeamMember as me,inviteToTeam as de,transferTeamOwnership as ue}from"./index-CvLuV8mT.js";import{u as he,V as ge,I as D}from"./use-toast-DpWWrysv.js";import{o as q,c as xe,B as f,a as h,S as je}from"./button-D-CbrSAB.js";import{H as w,T as O}from"./text-D7Hreo_J.js";import{H as P}from"./h-stack-MdeSV0qw.js";import{S as k}from"./select-DjjoEe5c.js";import{f as x,u as fe,c as j,a as G,b as pe}from"./use-style-config-BvA8OEwb.js";import{M as Me,a as ve,b as ye,c as be,d as Te,e as we,f as Se}from"./modal-overlay-lpV3bALa.js";import"./icon-BANxJJXO.js";import"./motion-OoEXE3Ue.js";const I=x(function(n,r){const s=fe("Badge",n),{className:p,...g}=q(n);return e.jsx(j.span,{ref:r,className:G("chakra-badge",n.className),...g,__css:{display:"inline-block",whiteSpace:"nowrap",verticalAlign:"middle",...s}})});I.displayName="Badge";const[Ie,v]=xe({name:"TableStylesContext",errorMessage:`useTableStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Table />" `}),A=x((a,n)=>{const r=pe("Table",a),{className:s,layout:p,...g}=q(a);return e.jsx(Ie,{value:r,children:e.jsx(j.table,{ref:n,__css:{tableLayout:p,...r.table},className:G("chakra-table",s),...g})})});A.displayName="Table";const H=x((a,n)=>{const r=v();return e.jsx(j.tbody,{...a,ref:n,__css:r.tbody})}),d=x(({isNumeric:a,...n},r)=>{const s=v();return e.jsx(j.td,{...n,ref:r,__css:s.td,"data-is-numeric":a})}),u=x(({isNumeric:a,...n},r)=>{const s=v();return e.jsx(j.th,{...n,ref:r,__css:s.th,"data-is-numeric":a})}),V=x((a,n)=>{const r=v();return e.jsx(j.thead,{...a,ref:n,__css:r.thead})}),S=x((a,n)=>{const r=v();return e.jsx(j.tr,{...a,ref:n,__css:r.tr})}),Pe=()=>{const{t:a}=se(),[n,r]=m.useState([]),[s,p]=m.useState(null),[g,J]=m.useState([]),[_,U]=m.useState(""),[C,B]=m.useState(""),[F,R]=m.useState("member"),[K,y]=m.useState(!1),[E,Q]=m.useState(""),c=he(),[b,i]=m.useState(!1),[z,l]=m.useState(null),[L,_e]=m.useState([]),[Ce,Ee]=m.useState(null),[N,W]=m.useState(null);m.useEffect(()=>{ne().then(W),M()},[]);const M=async()=>{i(!0),l(null);try{const t=await re();r(t),t.length>0&&(p(t[0]),T(t[0].id))}catch(t){l(t.message||a("teamManagement.error.failedToLoadTeams","Failed to load teams")),c({title:a("error","Error"),description:t.message,status:"error"})}finally{i(!1)}},T=async t=>{i(!0),l(null);try{const o=await ie(t);J(o)}catch(o){l(o.message||a("teamManagement.error.failedToLoadMembers","Failed to load members")),c({title:a("error","Error"),description:o.message,status:"error"})}finally{i(!1)}},X=async()=>{if(_.trim()){i(!0),l(null);try{await le({name:_}),U(""),M(),c({title:a("teamManagement.success.teamCreated","Team created"),status:"success"})}catch(t){l(t.message||a("teamManagement.error.failedToCreateTeam","Failed to create team")),c({title:a("error","Error"),description:t.message,status:"error"})}finally{i(!1)}}},Y=async()=>{if(C.trim()){i(!0),l(null);try{await de(s.id,{email:C,role:F}),B(""),R("member"),T(s.id),c({title:a("teamManagement.success.userInvited","User invited"),status:"success"})}catch(t){l(t.message||a("teamManagement.error.failedToInviteUser","Failed to invite user")),c({title:a("error","Error"),description:t.message,status:"error"})}finally{i(!1)}}},Z=async t=>{i(!0),l(null);try{await me(s.id,t),T(s.id),c({title:a("teamManagement.info.memberRemoved","Member removed"),status:"info"})}catch(o){l(o.message||a("teamManagement.error.failedToRemoveMember","Failed to remove member")),c({title:a("error","Error"),description:o.message,status:"error"})}finally{i(!1)}},$=async()=>{if(E){i(!0),l(null);try{await ue(s.id,Number(E)),y(!1),M(),c({title:a("teamManagement.success.ownershipTransferred","Ownership transferred"),status:"success"})}catch(t){l(t.message||a("teamManagement.error.failedToTransferOwnership","Failed to transfer ownership")),c({title:a("error","Error"),description:t.message,status:"error"})}finally{i(!1)}}},ee=async t=>{i(!0),l(null);try{await oe(t),M(),c({title:a("teamManagement.success.inviteAccepted","Invite accepted"),status:"success"})}catch(o){l(o.message||a("teamManagement.error.failedToAcceptInvite","Failed to accept invite")),c({title:a("error","Error"),description:o.message,status:"error"})}finally{i(!1)}},ae=async t=>{i(!0),l(null);try{await ce(t),M(),c({title:a("teamManagement.info.inviteDeclined","Invite declined"),status:"info"})}catch(o){l(o.message||a("teamManagement.error.failedToDeclineInvite","Failed to decline invite")),c({title:a("error","Error"),description:o.message,status:"error"})}finally{i(!1)}};return N&&N.plan!=="pro"&&N.plan!=="business"?e.jsxs(f,{p:8,children:[e.jsx(w,{size:"lg",mb:6,children:a("teamManagement.heading","Team Management")}),e.jsx(O,{color:"red.500",mb:4,children:a("teamManagement.proOnly","Team features are only available on Pro and Business plans.")}),e.jsx(h,{colorScheme:"blue",href:"/upgrade",children:a("teamManagement.upgradePlan","Upgrade Plan")})]}):e.jsxs(f,{p:8,"data-tour":"team-main",children:[e.jsx(w,{size:"lg",mb:6,"data-tour":"team-title",children:a("teamManagement.heading","Team Management")}),b&&e.jsx(je,{"data-tour":"team-loading"}),z&&e.jsx(O,{color:"red.500","data-tour":"team-error",children:z}),e.jsxs(ge,{align:"stretch",spacing:6,"data-tour":"team-content",children:[e.jsx(f,{"data-tour":"team-create",children:e.jsxs(P,{children:[e.jsx(D,{placeholder:a("teamManagement.newTeamName","New team name"),value:_,onChange:t=>U(t.target.value),"data-tour":"team-name-input"}),e.jsx(h,{colorScheme:"blue",onClick:X,isLoading:b,"data-tour":"team-create-btn",children:a("teamManagement.createTeam","Create Team")})]})}),e.jsx(f,{"data-tour":"team-select",children:e.jsx(k,{value:(s==null?void 0:s.id)||"",onChange:t=>{const o=n.find(te=>te.id===Number(t.target.value));p(o),T(o.id)},placeholder:a("teamManagement.selectTeam","Select a team"),"data-tour":"team-select-dropdown",children:n.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))})}),L.length>0&&e.jsxs(f,{children:[e.jsx(w,{size:"sm",mb:2,children:a("teamManagement.pendingInvites","Pending Invites")}),e.jsxs(A,{size:"sm",children:[e.jsx(V,{children:e.jsxs(S,{children:[e.jsx(u,{children:a("teamManagement.team","Team")}),e.jsx(u,{children:a("teamManagement.role","Role")}),e.jsx(u,{children:a("teamManagement.status","Status")}),e.jsx(u,{children:a("teamManagement.invitedAt","Invited At")}),e.jsx(u,{children:a("teamManagement.actions","Actions")})]})}),e.jsx(H,{children:L.map(t=>e.jsxs(S,{children:[e.jsx(d,{children:t.team_name}),e.jsx(d,{children:e.jsx(I,{children:t.role})}),e.jsx(d,{children:t.status}),e.jsx(d,{children:new Date(t.invited_at).toLocaleString()}),e.jsx(d,{children:t.status==="invited"&&e.jsxs(e.Fragment,{children:[e.jsx(h,{size:"xs",colorScheme:"green",onClick:()=>ee(t.id),children:a("teamManagement.acceptInvite","Accept")}),e.jsx(h,{size:"xs",colorScheme:"red",onClick:()=>ae(t.id),children:a("teamManagement.declineInvite","Decline")})]})})]},t.id))})]})]}),s&&e.jsxs(f,{children:[e.jsx(w,{size:"md",mb:4,children:a("teamManagement.members","Members")}),g.length===0?e.jsx(O,{color:"gray.500",children:a("teamManagement.noMembers","No members yet.")}):e.jsxs(A,{size:"sm",children:[e.jsx(V,{children:e.jsxs(S,{children:[e.jsx(u,{children:a("teamManagement.userId","User ID")}),e.jsx(u,{children:a("teamManagement.email","Email")}),e.jsx(u,{children:a("teamManagement.role","Role")}),e.jsx(u,{children:a("teamManagement.status","Status")}),e.jsx(u,{children:a("teamManagement.invitedAt","Invited At")}),e.jsx(u,{children:a("teamManagement.actions","Actions")})]})}),e.jsx(H,{children:g.map(t=>e.jsxs(S,{bg:t.user_id===s.owner_id?"yellow.50":void 0,children:[e.jsxs(d,{children:[t.user_id,t.user_id===s.owner_id&&e.jsx(I,{ml:2,colorScheme:"yellow",children:a("teamManagement.owner","Owner")})]}),e.jsx(d,{children:t.email||"-"}),e.jsx(d,{children:e.jsx(I,{colorScheme:t.role==="admin"?"blue":t.role==="member"?"green":"gray",children:t.role})}),e.jsx(d,{children:t.status}),e.jsx(d,{children:new Date(t.invited_at).toLocaleString()}),e.jsx(d,{children:e.jsx(h,{size:"xs",colorScheme:"red",onClick:()=>Z(t.user_id),isDisabled:t.user_id===s.owner_id,children:a("teamManagement.removeMember","Remove")})})]},t.id))})]}),e.jsxs(P,{mt:4,children:[e.jsx(D,{placeholder:a("teamManagement.inviteEmail","Invite email"),value:C,onChange:t=>B(t.target.value)}),e.jsxs(k,{value:F,onChange:t=>R(t.target.value),w:"120px",children:[e.jsx("option",{value:"member",children:a("teamManagement.roleMember","Member")}),e.jsx("option",{value:"admin",children:a("teamManagement.roleAdmin","Admin")}),e.jsx("option",{value:"viewer",children:a("teamManagement.roleViewer","Viewer")})]}),e.jsx(h,{colorScheme:"blue",onClick:Y,isLoading:b,children:a("teamManagement.inviteUser","Invite")})]}),e.jsx(h,{mt:4,colorScheme:"yellow",onClick:()=>y(!0),children:a("teamManagement.transferOwnership","Transfer Ownership")}),e.jsxs(Me,{isOpen:K,onClose:()=>y(!1),children:[e.jsx(ve,{}),e.jsxs(ye,{children:[e.jsx(be,{children:a("teamManagement.transferOwnership","Transfer Ownership")}),e.jsx(Te,{}),e.jsx(we,{children:e.jsx(k,{placeholder:a("teamManagement.selectNewOwner","Select new owner"),value:E,onChange:t=>Q(t.target.value),children:g.filter(t=>t.user_id!==s.owner_id).map(t=>e.jsx("option",{value:t.user_id,children:t.user_id},t.user_id))})}),e.jsxs(Se,{children:[e.jsx(h,{variant:"ghost",mr:3,onClick:()=>y(!1),children:a("teamManagement.cancel","Cancel")}),e.jsx(h,{colorScheme:"yellow",onClick:$,isLoading:b,children:a("teamManagement.transfer","Transfer")})]})]})]})]})]})]})};export{Pe as default};
//# sourceMappingURL=TeamManagement-DJapVZ9t.js.map
